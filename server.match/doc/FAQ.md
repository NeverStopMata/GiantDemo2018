# FAQ 常见问题

## 2018.1 培训生问答

每人开自己的章节，以名字为章节名(按拼音序)，提出问题.

### 车嘉泰

#### 以组件的方式来组织
Q: 服务器这边的架构如果是像unity3d 这样 以组件的方式来组织，例如 数据库组件，场景服务器组件等等，之间的通讯使用类似与DNS这种方式，与球球大作战的那种服务器架构相比，这样的服务器架构设计有哪些好处和坏处？

金庆: 应用组件的思想来架构一个系统是个好主意，应该比现有的球球或征途服务器架构好。
好处是容易理解，坏处是设计通用的服务组件并不容易。

#### 手机端游戏的服务器和客户端游戏的服务器具体有哪些差别？
金庆: 好像没什么区别吧？

#### 服务器架构
Q: 现在世面上mmorpg 和 FPS 游戏使用最多的服务器架构分别是那些，还有就是国内的游戏大厂与国外的3A游戏大厂，在服务器方面的区别主要是什么？

金庆：中国的游戏服务器是最先进的，中国的游戏服务器程序员是最厉害的。具体区别不太清楚。

#### 集成的引擎
Q: 游戏引擎可能主要是和客户端部分有着比较大的关系，有没有那些引擎在服务端有着良好的支持或者对服务端有着很好的集成的引擎？服务器在进行资源管理的时候有没有一些比较好用的类似与客户端引擎的可视化资源管理工具？

金庆：Unity有自己的服务器，不过好像没人用。服务器端没什么资源管理，只有一些配置文件，不需要专用的工具。

### 陈通

#### 想尽快成长
Q: 之前在学校学的是C/C++语言，没有接触过go语言。来到巨人之后，感觉身边的同事都很优秀，我压力挺大的，最近一有时间就在看go语言，我想做服务器这方面，但有时候对自己信心不足，想尽快成长起来，想问问老师能给我一些建议吗？

金庆：等完成这个Demo后就会信心满满了。目前的建议是多学多练。
刘清：大家都一样，之前应该都没有接触过Go，和学其他语言应该是差不多的，看完基本语法再看一些源码，自己也多敲敲，就会有很大提升吧，大家一起加油！

#### 平常主要是干什么工作
Q: 想问问老师我们进入项目之后，服务器这方面平常最主要是干什么工作？

金庆：写代码。

#### 需要对客户端了解吗？
Q: 想要干好服务器这方面的工作，我需要对客户端的知识（老师这两天给我们上的unity课程）有深刻的了解吗？

金庆：了解是必须的。深刻点有好处。

### 范俊
#### 在搭建服务器时，服务层面是否会有宕机情况？应如何避免？

金庆：会。多测试可避免宕机。

#### 野蛮人服务器架构与征途服务器架构对比，各有什么特点？
#### 从球球和野蛮人可以看出go语言很适合小型移动端游戏服务器，那么go语言搭建的服务器能否满足大型MMORPG游戏的需求？
#### RoomServer由于核心玩法的不一样，往往需要做更多的工作。那么在架构层是否有改进方法？

### 冯浩

开发游戏服务器时
#### 如何高性能的搭建tcp底层，并且能负载到同时在线N多人
#### goroutine间如何高效通信
A:王宗宝:goroutine就是靠chan通讯。如果关心goroutine通讯的各种开销，最好是按自己的应用场景测试看看。
有些场景下chan通讯是不划算的，比如一个简单的map数据获取，可能用锁就可以了。有些场景用chan是必须的，比如做个多人互动功能。
还有就是带buffer的chan和不带buffer的chan的差异，最好通过试验来让自己有个直观认识，除了异步和同步的差异，还会有边界情况的处理差异，比如带buffer的chan阻塞了。

#### go开发的服务器如何进行压测

### 雷腾
#### 客户端开发应该怎样在服务器课程中学习，着重掌握哪些服务器知识

金庆：需要了解服务器架构，如何编译运行，最好是有能力做简单的服务器开发。

#### 逻辑
Q: 战斗系统的状态机转换逻辑应该写在客户端还是服务端，是不是把逻辑写在客户端，如果需要切换到某一状态，只需要向服务器申请，服务器同意之后客户端自己切换即可

车嘉泰: 感觉应该写在服务端，在进行状态转换申请的同时在服务端逻辑进行对应的状态转换。但是各种状态是在服务端和客户端同时存在的。中间应该算是有个状态同步的问题

#### 同步的选择
Q: 状态同步和帧同步的选择究竟应该遵循哪些原则，如果一个类似野蛮人大作战的游戏和一个moba类的游戏，应该怎样选择
#### 同步控制英雄行走
Q: 客户端和服务器同步控制英雄行走的过程是怎样的，服务器收到行走方向的信息然后怎样计算，客户端收到服务器计算的结果后，又怎么样计算插值

### 李建华
#### 我们之前学习了linux的基础，但今天go服务器却是在windows开发的，这两个平台搭建服务器有何区别，之后能否将其移植到linux平台上？

金庆：Go服务器是跨平台的，正常运营会在Linux平台。Windows下开发比Linux下方便。

#### 像野蛮人大作战这种游戏，如何解决网络延迟同步？

#### 我之前使用visual studio时，可以附加到进程中来调试服务器运行时出现的问题，在liteIDE中应该如何调试？

金庆：据我所知，Golang IDE 都没附加到进程功能，命令行调试器 gdb, delve 有 attach.
LiteIDE中调试须先断点，然后开始调试。

车嘉泰: 建议使用jetbrains的golang IDE ， 有自带的编译调试功能，而且在写代码的过程做还会做编译检查

### 刘清

#### 服务器和客户端协作
Q: 服务器和客户端协作的细节部分不清楚，比如，玩家动了一下，此时客户端发给服务器玩家动了一下的消息，那服务器做哪些处理？它的逻辑执行顺序是怎样的，又会返回给客户端具体什么消息，然后客户端又要做什么？

#### 服务器在运行很久之后应该会生成大量的数据，而且是不能删除的重要数据，那么面对越来越多的数据，服务器怎么处理？

金庆：存数据库。

#### 协程一定比线程效率高吗？Go语言适用于高并发是不是主要是因为它使用协程很方便。
####冯浩：协程和线程的区别基本上就是非抢占式和抢占式的区别。现在的操作系统的进程/线程调度模型是抢占式的。在用户空间下无法完全自主控制进程/线程的切换，
GO语言在处理高并发上的优势一个原因正是因为它在语言层面上支持协程

金庆：是。是。

车嘉泰: 感觉如果是专门为了游戏而作的操作系统，对于线程这方面肯定有极端的优化，比如ps4 或 xbox 的操作系统

### 钱达

#### 为什么用go来开发游戏服务器？
#### 传输方案？
Q: 位置的移动用udp传输，因为如果从(0,0)到(1,0)然后到(2,0)，最终位置是到了(2,0)，不在乎(1,0)的丢失。可是(1,0)丢失会产生严重的问题，比如，人物在(1,0)时受到攻击，如果丢失了就无法检测到了。有没有折衷的传输方案？
#### 服务器和客户端之间传送消息的安全性从哪个方面入手？

车嘉泰: 各个方面。 硬件： 可以用专用硬件进行数据加密 软件：使用Ipsec vpn 来进行安全连接

### 覃振华
#### 服务器和客户端怎么同步数据
#### 客户端和服务器的接口怎么写 
#### Unity如何调用别的语言

### 尚昱林
#### 发生碰撞
Q: 多人联网对战时，对方位置同步是根据服务器实时返回对方坐标来确定的，但是当发生碰撞等情况时，确定对方状态会有什么不同？
#### Linux环境
Q: 之前服务器都是在Linux环境下进行操作的，但是现在学Go语言是在Windows环境下，想知道以后服务器端具体要在那个平台进行，还是说要在Linux环境下进行Go语言开发？

金庆：征途服务器会在Linux下开发，其他服务器无限制，但运营一般都在Linux下。

#### 数据库同步
Q: 如何确保服务器上的数据和数据库同步，并且将数据及时发送给玩家，同时还要降低延时。

### 王晓洁

#### 客户端与服务器的连接中什么情况下应该使用TCP连接，什么时候应该使用UDP连接，什么时候应该使用HTTP连接？
#### 务器与客户端的传输协议通过需要遵循哪些原则？
#### 目前服务器开发中主要的性能瓶颈实在什么地方？

### 王宗宝

#### 场景和角色同步？
Q: 游戏中的对于不同的数据会分配给不同的服务器去实现，比如场景和角色加入不在同一服务器中运算，如何做到场景和角色同步？
#### 客户端不可信
Q: 客户端和服务器进行通信，认为客户端不可信，服务器如何保证或者确认收到的每条客户端信息中途没有被修改过的？
####冯浩双方定制一套规范的标准，双方对对端的消息进行校验
#### 云服务器
Q: 现在一些大的公司办公采用云服务器，他们是如何为每一个员工分配内存和服务器的？

金庆：每人可分配一个或多个虚拟机，内存按需要分配。

### 徐子彦

我是游戏服务器开发实习生，今天学习了项目实战后，对客户端和服务器的源码有了
清晰的认识，在此提出几个疑惑点：

#### 怎么传递消息
Q: 服务器架构里表明loginserver，roomserver等结构的架构，想知道服务器到另一个服
务器怎么传递消息，是采取进程间通信的方法管道或者socket，还是go有特殊的方法？

#### 为啥不都用go
Q: go语言相比较c++而言，我觉得最大不同之处是gc机制，在c++中比较常见使用智能
指针管理内存，简单看了go语言的gc，也是使用引用机制，通过gc机制，go语言甚至
可以返回栈上的对象（对象逃逸），而且go语言服务器看起来比c++简单清晰很多，
引入包机制效果也很好，还有编译也不像c++一样麻烦，那么这都是go相比c++的好
处，但是c++服务器相比go有没有好处呢？如果没有好处，肯定都转向go，目前来
看，go还不是很普及。（简单说，go语言特性很好，为啥不都用go）

金庆：C++运行性能高。如果有选择都会选Golang, 但是旧系统维护没得选。

#### 发展
Q: 客户端这块，我对引擎渲染，或者说图形学一知半解，懂一点点光的知识，假如以
后想往全栈工程师方向发展，客户端这边引擎底层渲染机制等是不是也要透彻了解？
服务器这块，是不是mysql这样的数据库使用逐渐减少，取而代之nosql？

金庆：了解一点引擎底层有好处。mysql和nosql会一起使用。

### 易波

#### 游戏服务端和客户端开发的难点分别在哪里？
#### 游戏服务端和Web服务端有什么区别？
#### 游戏服务端用Go和C++各有什么利弊？

### 易佳
#### unity3d打包讲解课程中，NativeDllTest生成 PC 端和 Android 端相应的 dll 和 so 文件的原理。
#### Go 服务器项目中，消息的总体处理流程是什么, 中间的消息传输格式和机制是什么？
#### Go 服务器 run.bat会启动 5个服务，每个服务的意义和具体启动的是什么？
#### 在状态同步下，如果客户端发送了一个假的位置消息，服务器应该如何应对，是否需要作与上一次位置比对判断？ 

### 张寒城
#### Golang语言的优势高并发性的原理是什么？
#### 游戏服务器端语言的更新换代时间大约是多少？
#### Golang 的并发与 Erlang、Scala、Node.js 和 Python 的并发模型相比有何特点？ 

### 张璐

#### 连接失败
Q: 今天看到了服务器和客户端的代码并且进行了简单的测试连接。可以发现任何一个项目都有着复杂的逻辑和十足的代码，所以如果客户端和服务器连接失败，可能的原因都有哪些，而且我们应该怎么进行排查？

#### 哪种结构更好
Q: 对于服务器的架构，有人说网状结构利于开发和逻辑，并且能够得到不错的相应。有的人说树状结构极其利于功能模块的扩展，尤其在后期需要加入某些逻辑或者功能模块，并且如果出现错误，方便排查。那么请问哪种结构更好点，或者说哪种情况下使用网状结构好，哪种情况下使用树状结构好？

#### 运行中的服务器一般对于客户端的非法访问的处理方式是怎样的？
